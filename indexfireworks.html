<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fireworks-2026-bayyy_</title>
    <style>
        * { margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; overflow: hidden; background: #000; }
        canvas { display: block; position: absolute; top: 0; left: 0; }
        
        /* Tombol Magic (Kanan Bawah) */
        #magicBtn {
            position: fixed; bottom: 30px; right: 30px;
            width: 65px; height: 65px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer; display: flex;
            align-items: center; justify-content: center;
            backdrop-filter: blur(10px); z-index: 1001;
        }

        /* Tombol Gunung/Background (Kiri Bawah) */
        #bgBtn {
            position: fixed; bottom: 30px; left: 30px;
            width: 65px; height: 65px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer; display: flex;
            align-items: center; justify-content: center;
            backdrop-filter: blur(10px); z-index: 1001;
        }
        #bgBtn svg { width: 35px; height: 35px; fill: #fff; opacity: 0.8; }
        #magicBtn svg { width: 30px; height: 30px; fill: #fff; }
    </style>
</head>
<body>

    <div id="bgBtn" onclick="gantiBackground()">
        <svg viewBox="0 0 24 24"><path d="M14,6L10.25,11L13.12,14.82L12,15.7C10.5,14.2 8,11 8,11L1,21H23L14,6Z"/></svg>
    </div>

    <div id="magicBtn" onclick="mulaiPertunjukanSpesial()">
        <svg viewBox="0 0 24 24"><path d="M7.5,5L10,8.5L8.5,10L5,7.5L3.5,10L2,8.5L4.5,5L2,1.5L3.5,0L5,2.5L8.5,0L10,1.5L7.5,5M14.7,10.23L22,17.49L20.5,19L13.21,11.73L14.7,10.23M17.2,10.23L20.5,13.5L19,15L15.7,11.73L17.2,10.23Z"/></svg>
    </div>

    <canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let fireworks = [], particles = [];
    let sedangTampil = false, globalDissolveTrigger = false;
    let bgMode = 0; // 0: Polos, 1: Kota, 2: Gunung

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
   window.addEventListener('resize', () => {
    // 1. Reset ukuran kanvas
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    // 2. Buat ulang data bintang agar full layar
    buatStars();
    
    // 3. Buat ulang data gedung agar full layar sampai ke ujung kanan
    buatDataKota();
});

    function gantiBackground() {
        bgMode = (bgMode + 1) % 3;
    }

    // --- AUDIO ENGINE: BROWN NOISE (REALISTIC) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function createBrownNoise() {
        const bufferSize = 2 * audioCtx.sampleRate,
              noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate),
              output = noiseBuffer.getChannelData(0);
        let lastOut = 0.0;
        for (let i = 0; i < bufferSize; i++) {
            const white = Math.random() * 2 - 1;
            output[i] = (lastOut + (0.02 * white)) / 1.02;
            lastOut = output[i];
            output[i] *= 3.5;
        }
        return noiseBuffer;
    }
    const brownNoiseBuffer = createBrownNoise();

    function playDeepBoom() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const source = audioCtx.createBufferSource();
        source.buffer = brownNoiseBuffer;
        const filter = audioCtx.createBiquadFilter();
        filter.type = "lowpass";
        filter.frequency.setValueAtTime(80 + Math.random() * 120, audioCtx.currentTime);
        const gain = audioCtx.createGain();
        gain.gain.setValueAtTime(1.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.2);
        source.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
        source.start();
    }

    function playLaunchWhoosh() {
        const source = audioCtx.createBufferSource();
        source.buffer = brownNoiseBuffer;
        const filter = audioCtx.createBiquadFilter();
        filter.type = "bandpass";
        filter.frequency.setValueAtTime(500, audioCtx.currentTime);
        const gain = audioCtx.createGain();
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
        source.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
        source.start();
    }

    const mapHuruf = {
        'S': [[0,0],[1,0],[2,0],[0,1],[0,2],[1,2],[2,2],[2,3],[0,4],[1,4],[2,4]],
        'E': [[0,0],[1,0],[2,0],[0,1],[0,2],[1,2],[2,2],[0,3],[0,4],[1,4],[2,4]],
        'L': [[0,0],[0,1],[0,2],[0,3],[0,4],[1,4],[2,4]],
        'A': [[1,0],[0,1],[2,1],[0,2],[1,2],[2,2],[0,3],[2,3],[0,4],[2,4]],
        'M': [[0,0],[2,0],[0,1],[1,1],[2,1],[0,2],[2,2],[0,3],[2,3],[0,4],[2,4]],
        'T': [[0,0],[1,0],[2,0],[1,1],[1,2],[1,3],[1,4]],
        'H': [[0,0],[2,0],[0,1],[2,1],[0,2],[1,2],[2,2],[0,3],[2,3],[0,4],[2,4]],
        'U': [[0,0],[2,0],[0,1],[2,1],[0,2],[2,2],[0,3],[2,3],[0,4],[1,4],[2,4]],
        'N': [[0,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2],[0,3],[2,3],[0,4],[2,4]],
        'B': [[0,0],[1,0],[0,1],[2,1],[0,2],[1,2],[0,3],[2,3],[0,4],[1,4]],
        'R': [[0,0],[1,0],[0,1],[2,1],[0,2],[1,2],[0,3],[2,3],[0,4],[2,4]],
        '2': [[0,0],[1,0],[2,0],[2,1],[1,2],[0,3],[0,4],[1,4],[2,4]],
        '0': [[0,0],[1,0],[2,0],[0,1],[2,1],[0,2],[2,2],[0,3],[2,3],[0,4],[1,4],[2,4]],
        '6': [[0,0],[1,0],[2,0],[0,1],[0,2],[1,2],[2,2],[0,3],[2,3],[0,4],[1,4],[2,4]],
    };

    class Firework {
        constructor(tx, ty, char = null, warna = null) {
            this.x = canvas.width / 2;
            this.y = canvas.height;
            this.sx = this.x; this.sy = this.y;
            this.tx = tx; this.ty = ty;
            this.char = char;
            this.warna = warna !== null ? warna : Math.random() * 360;
            this.t = 0;
            this.speed = char ? 0.007 : 0.012;
            this.cpX = this.sx + (this.tx - this.sx) / 2 + (Math.random() * 80 - 40);
            this.cpY = this.ty + 180;
            this.history = [];
            playLaunchWhoosh();
        }

        update(idx) {
            this.t += this.speed;
            const t = this.t;
            this.x = Math.pow(1-t, 2)*this.sx + 2*(1-t)*t*this.cpX + Math.pow(t, 2)*this.tx;
            this.y = Math.pow(1-t, 2)*this.sy + 2*(1-t)*t*this.cpY + Math.pow(t, 2)*this.ty;
            this.history.push({x: this.x, y: this.y});
            if(this.history.length > 18) this.history.shift();
            if(this.t >= 1) {
                playDeepBoom();
                this.explode();
                fireworks.splice(idx, 1);
            }
        }

        explode() {
            if(this.char) {
                const dots = mapHuruf[this.char];
                dots.forEach(d => {
                    for(let i=0; i<25; i++) {
                        particles.push(new Particle(this.tx + d[0]*14 + (Math.random()-0.5)*10, this.ty + d[1]*14 + (Math.random()-0.5)*10, this.warna, true));
                    }
                });
            } else {
                const shapes = ['normal', 'love', 'star', 'oval'];
                const s = shapes[Math.floor(Math.random()*shapes.length)];
                for(let i=0; i<100; i++) particles.push(new Particle(this.tx, this.ty, this.warna, false, s, i/100));
            }
        }

        draw() {
            if(this.history.length < 2) return;
            ctx.beginPath();
            ctx.strokeStyle = `hsla(${this.warna}, 100%, 70%, ${0.5 * (1-this.t)})`;
            ctx.lineWidth = 1.8;
            ctx.moveTo(this.history[0].x, this.history[0].y);
            this.history.forEach(p => ctx.lineTo(p.x, p.y));
            ctx.stroke();
        }
    }

    class Particle {
        constructor(x, y, hue, isChar, shape = 'normal', ratio = 0) {
            this.x = x; this.y = y;
            this.hue = hue;
            this.isChar = isChar;
            this.alpha = 1;
            this.isFrozen = false;
            this.targetX = x; this.targetY = y;
            this.angle = Math.random() * Math.PI * 2;
            this.speed = isChar ? (Math.random() * 4) : (Math.random() * 7 + 2);
            this.friction = 0.95;
            this.gravity = isChar ? 0 : 0.15;
            this.shape = shape;
            this.dissolveSpeed = 0.01 + Math.random() * 0.02;
            this.vxDissolve = (Math.random() - 0.5) * 1.5;

            if(!isChar && shape !== 'normal') {
                if(shape === 'love') {
                    const t = ratio * Math.PI * 2;
                    this.vx = 16 * Math.pow(Math.sin(t), 3);
                    this.vy = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                    this.speed = 0.25;
                } else if(shape === 'star') {
                    const t = ratio * Math.PI * 2;
                    this.speed *= (Math.abs(t) % (Math.PI/2.5) < 0.2) ? 2.5 : 0.8;
                } else if(shape === 'oval') {
                    this.vx = Math.cos(this.angle) * 3; this.vy = Math.sin(this.angle) * 1.2;
                    this.speed *= 0.8;
                }
            }
        }

        update(idx) {
    if (this.isChar) {
        if (!globalDissolveTrigger) {
            // Logika saat membentuk huruf (diam/frozen)
            if (!this.isFrozen) {
                this.x += (this.targetX - this.x) * 0.15;
                this.y += (this.targetY - this.y) * 0.15;
                if (Math.abs(this.x - this.targetX) < 0.2) this.isFrozen = true;
            }
        } else {
            // --- LOGIKA BARU: PECAH MENYEBAR ---
            if (this.isFrozen) {
                // Berikan dorongan kecepatan acak ke segala arah saat pertama kali pecah
                const angle = Math.random() * Math.PI * 2;
                const force = Math.random() * 2 + 1; // Kekuatan ledakan
                this.vx = Math.cos(angle) * force;
                this.vy = Math.sin(angle) * force;
                this.isFrozen = false; // Cairkan status frozen
            }

            // Gerakkan partikel berdasarkan kecepatan pecah tadi
            this.x += this.vx;
            this.y += this.vy;
            
            // Tambahkan sedikit gesekan agar melambat pelan-pelan (opsional)
            this.vx *= 0.98;
            this.vy *= 0.98;

            // Memudar dan menghilang
            this.alpha -= this.dissolveSpeed;
        }
    } else {
        // Logika untuk kembang api biasa (tetap seperti semula)
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + 0.15;
        this.speed *= this.friction;
        this.alpha -= 0.015;
    }

    if (this.alpha <= 0) particles.splice(idx, 1);
}

        draw() {
            ctx.save();
            ctx.fillStyle = `hsla(${this.hue}, 100%, 75%, ${this.alpha})`;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.isChar ? 0.6 : 1.3, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
    }

let stars = [];
function buatStars() {
    stars = []; // Reset array
    // Gunakan angka yang besar (misal 400) agar padat
    for(let i=0; i<400; i++) {
        stars.push({
            x: Math.random() * window.innerWidth, 
            y: Math.random() * window.innerHeight, 
            s: Math.random() * 1.5,
            opacity: Math.random()
        });
    }
}
buatStars(); // Jalankan sekali saat startup

// Tambahkan pemanggilan fungsi ini di dalam function resize() agar bintang menyesuaikan layar baru
window.addEventListener('resize', () => {
    resize();
    buatStars(); 
});

let cityData = [];
function buatDataKota() {
    cityData = [];
    const lebarGedung = 80;
    for(let i = 0; i < window.innerWidth + lebarGedung; i += lebarGedung) {
        let tinggi = Math.random() * 200 + 100;
        let lampu = [];
        // Tentukan posisi lampu sekali saja di sini
        for(let ly = 20; ly < tinggi - 20; ly += 20) {
            for(let lx = 10; lx < lebarGedung - 10; lx += 15) {
                if(Math.random() > 0.3) lampu.push({x: lx, y: ly});
            }
        }
        cityData.push({x: i, h: tinggi, lights: lampu});
    }
}
function buatDataKota() {
    cityData = []; // Kosongkan data lama
    const lebarGedung = 80;
    // Tambahkan toleransi +200 agar gedung menutupi layar meski ada sedikit pergeseran
    for(let i = 0; i < window.innerWidth + 200; i += lebarGedung) {
        let tinggi = Math.random() * 250 + 100; // Tinggi gedung bervariasi
        let lampu = [];
        // Tentukan posisi lampu statis agar tidak berkedip
        for(let ly = 30; ly < tinggi - 30; ly += 25) {
            for(let lx = 15; lx < lebarGedung - 15; lx += 20) {
                if(Math.random() > 0.4) {
                    lampu.push({ x: lx, y: ly });
                }
            }
        }
        cityData.push({ x: i, h: tinggi, w: lebarGedung, lights: lampu });
    }
}
function drawBackground() {
    ctx.save();
    
    // SELALU GAMBAR BINTANG (Agar saat pindah mode bintang tetap ada di langit)
    ctx.fillStyle = "white";
    stars.forEach(s => {
        ctx.globalAlpha = s.opacity; 
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.s, 0, Math.PI * 2);
        ctx.fill();
    });
    ctx.globalAlpha = 1.0;

    // GAMBAR BULAN (Hanya muncul jika bukan mode polos)
    if (bgMode !== 0) {
        ctx.fillStyle = "#FFF5E1";
        ctx.shadowBlur = 15; ctx.shadowColor = "white";
        ctx.beginPath(); ctx.arc(canvas.width * 0.85, 80, 35, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
    }

    if (bgMode === 1) { // TEMA KOTA
    cityData.forEach(g => {
        // Gambar Badan Gedung
        // Gunakan warna biru sangat gelap agar kontras dengan lampu
        ctx.fillStyle = "#05050a"; 
        ctx.fillRect(g.x, canvas.height - g.h, g.w - 5, g.h); // g.w-5 memberi celah antar gedung
        
        // Gambar Lampu Statis (Kuning Keemasan)
        ctx.fillStyle = "#f1c40f";
        g.lights.forEach(l => {
            ctx.fillRect(g.x + l.x, canvas.height - g.h + l.y, 5, 8);
        });
    });
}

else if (bgMode === 2) { // TEMA GUNUNG
        ctx.fillStyle = "#080808";
        ctx.beginPath();
        ctx.moveTo(0, canvas.height);
        ctx.lineTo(canvas.width * 0.2, canvas.height * 0.7);
        ctx.lineTo(canvas.width * 0.5, canvas.height * 0.85);
        ctx.lineTo(canvas.width * 0.8, canvas.height * 0.6);
        ctx.lineTo(canvas.width, canvas.height);
        ctx.fill();
    }
    
    ctx.restore();
}

    async function mulaiPertunjukanSpesial() {
        if(sedangTampil) return;
        sedangTampil = true; 
            globalDissolveTrigger = false;


        const baris = ["SELAMAT", "TAHUN BARU", "2026"], warna = [45, 200, 120]; 
        for(let b = 0; b < baris.length; b++) {
            const kata = baris[b], y = canvas.height * 0.25 + (b * 130), xAwal = (canvas.width/2)-(kata.length*21);
            for(let i = 0; i < kata.length; i++) {
                if(kata[i] === ' ') continue;
                fireworks.push(new Firework(xAwal + (i * 42), y, kata[i], warna[b]));
                await new Promise(r => setTimeout(r, 320));
            }
            await new Promise(r => setTimeout(r, 800));
        }
        setTimeout(() => {
            globalDissolveTrigger = true;
            const check = setInterval(() => {
                if (particles.filter(p => p.isChar).length === 0) { clearInterval(check); sedangTampil = false; }
            
              }, 500);
        }, 4000);
    }

    function loop() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        drawBackground(); // Gambar background di setiap frame
        
        fireworks.forEach((f, i) => f.update(i));
        fireworks.forEach(f => f.draw());
        particles.forEach((p, i) => p.update(i));
        particles.forEach(p => p.draw());
        requestAnimationFrame(loop);
    }

    canvas.addEventListener('mousedown', (e) => {
        if(!sedangTampil) fireworks.push(new Firework(e.clientX, e.clientY));
    });
    loop();
</script>
</body>
</html>